<!doctype html>
<html class="no-js" lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  <title>Tests for cichlid</title>

  <meta name="viewport" content="width=device-width">
  <link rel="stylesheet" href="css/ui-test-light.css">

  <!--
  This is for client-side compiled version of LESS.
  See http://lesscss.org/ to learn more about LESS.

  It should not be used in production or if you are
  compiling LESS yourself.

  Consider using http://livereload.com/

  <link rel="stylesheet/less" href="css/test.less">
  <script src="js/libs/less-1.3.0.min.js"></script>

  -->

  <script type="text/javascript" src="http://use.typekit.com/qnf5iux.js"></script>
  <script type="text/javascript">try{Typekit.load();}catch(e){}</script>

</head>
<body>
  <header>
    <div id="logo"></div>
    <div id="butter-header-buttons">
      <!--
      <a id="add-popcorn" class="butter-btn-dark"><i class="icon icon-white icon-comment"></i> Add Popcorn</a>
    

      <a class="butter-btn-dark">Save</a>    
      <a class="butter-btn-dark"><i class="icon icon-white icon-cog"></i> Settings</a>
      <a class="butter-btn-dark"><i class="icon icon-white icon-share"></i> Share</a>
    -->
      <a id="butter-editor-close-btn" class="butter-btn-dark butter-editor-close-btn"><i class="icon icon-chevron"></i>Editor</a>
    </div> 
  </header>
  <div id="wrapper" class="butter-wrapper">
    <section id="stage" class="butter-stage">
      <div class="butter-embed-container">
  
       <div id="media-source" class="butter-media-source">
          <a class="butter-btn-dark"><i class="icon icon icon-pencil"></i> Edit media</a>
        </div>
    
        <div class="butter-video-container">
          <video id="video" preload data-butter="media" controls>
            <source src="http://ia700300.us.archive.org/9/items/nozon-test1/Nozon-test_512kb.mp4">
            <source src="http://ia700300.us.archive.org/9/items/nozon-test1/Nozon-test.ogv">
          </video>
        </div>
      </div>
    </section>
    <section id="editor" class="butter-editor">
        <div class="butter-editor-outer">
          <div class="butter-editor-inner">          
          </div>
        </div>
    </section>
    <section id="tray" class="butter-tray">
      <div id="controls" class="butter-controls">
        <div id="butter-controls-inner" class="butter-controls-inner">
          <ul id="butter-visualization"></ul>
          <span id="butter-range" class="butter-range">  
          </span>
          <span id="butter-scrubber" class="butter-scrubber">
            <span class="butter-scrubber-head"></span>
          </span> 
        </div>
      </div>
      <div id="butter-tracks-container">
        <div>
          <ul id="butter-tracks">
            <span id="butter-scrubber-large" class="butter-scrubber-large"></span>
          </ul>
      </div>
    </section>
  </div>

  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.9/jquery-ui.min.js"></script>
  <script src="js/libs/jquery.localScroll.min.js"></script>
  <script src="js/script.js"></script>
  <script>

    var butter = {},
        i,
        l;

    butter.duration = 80;
    butter.tracks = [ 1, 2, 3 ];
    butter.orderedTrackEvents = [
      {
        track: 1,
        start: 3,
        end: 5
      },
      {
        track: 2,
        start: 10,
        end: 15
      },
      {
        track: 2,
        start: 24,
        end: 30
      },
      {
        track: 3,
        start: 24,
        end: 35
      },
      {
        track: 1,
        start: 67,
        end: 75
      }
    ];

    function addVisualizationEl( obj) {
      var dur = butter.duration,
          el,
          trackEl,
          ul = document.getElementById( "butter-visualization" ),
          tracks = document.getElementById( "butter-tracks" ),
          start = obj.start,
          end = obj.end,
          track = obj.track,
          totalTracks = butter.tracks.length;

      el = document.createElement( "li" );
      el.style.left = start / dur * 100 + "%";
      el.style.right = ( dur - end ) / dur * 100 + "%";
      el.style.top = track / totalTracks * 100 + "%";

      trackEl = el.cloneNode( "true" );

      ul.appendChild( el );
      tracks.appendChild( trackEl );

    }

    document.getElementById( "butter-editor-close-btn" ).addEventListener( "click", function(){
      document.body.classList.toggle( "butter-editor-collapsed" );
    });

    /*
    document.getElementById( "edit-media" ).addEventListener( "click", function(){
      document.body.classList.toggle( "butter-tray-collapsed" );
    });

    */

    for ( i = 0, l = butter.orderedTrackEvents.length; i < l; i++ ) {
      addVisualizationEl( butter.orderedTrackEvents[ i ] );
    }

    function viewerToTray( val ) {
      var tray = $( "#butter-tracks" ).width(),
          viewer = $( "#butter-controls-inner" ).width(),
          ratio = tray/viewer;

      return val * ratio;
    }

    function updateScrubbers() {
      var small = document.getElementById( "butter-scrubber" ),
          large = document.getElementById( "butter-scrubber-large" );

      large.style.left = viewerToTray( small.style.left );

    }

    function resetView( el ) {
      var y = $( "#butter-tracks" ).width(),
            a = $( el ).width(),
            l = el.style.left.replace( "px", "" ),
            x = $( "#butter-tracks-container" ).width(),
            b = $( "#butter-controls-inner" ).width(),
            newY = x * b / a,
            newX = ( l / b ) * newY;

        $( "#butter-tracks" ).width( newY );
        $( "#butter-tracks-container" ).scrollTo( newX, 0 );
        updateScrubbers();

    }

    $( ".butter-scrubber" ).draggable({ 
      axis: "x",
      containment: "#butter-controls-inner",
      drag: function( event, ui ) {
        var newScrubberPos = viewerToTray( ui.position.left );
        document.getElementById( "butter-scrubber-large" ).style.left = newScrubberPos + "px";

      },
      stop: function( event, ui ) {
        var total = $( "#butter-controls-inner" ).width(),
            endPos = ui.position.left,
            leftInPercent =  endPos/ total * 100 + "%";

        this.style.left = leftInPercent;
        document.getElementById( "butter-scrubber-large" ).style.left = leftInPercent;

      }
    });

    $( ".butter-range" ).draggable(
      { axis: "x",
      containment: "#butter-controls-inner",
      drag: function( event, ui ) {
        resetView( this );
      }
    }).resizable({ 
      handles: "e, w", 
      containment: "#butter-controls-inner",
      resize: function( event, ui ) {
        resetView( this );
      }
    });

    $( "#butter-scrubber-large" ).draggable({ 
      axis: "x",
      containment: "#tray"
    });


  </script>
</body>
</html>
